"""
Fix additional imperative forms found by the audit agent.
Category A: UI elements (must fix)
Category B: Choice/action labels (fix for consistency)
"""
import json, sys, os

sys.stdout = open(sys.stdout.fileno(), mode='w', encoding='utf-8', buffering=1)

json_path = os.path.join(os.path.dirname(os.path.abspath(__file__)),
                         '..', 'Russian_UI', 'full_translation_mapping.json')

with open(json_path, 'r', encoding='utf-8') as f:
    data = json.load(f)

print(f"Loaded {len(data)} entries")

# Category A: UI elements (exact value match)
fixes = {
    # PRESS TO START
    "НАЖМИТЕ ДЛЯ ЗАПУСКА": "НАЖАТЬ ДЛЯ ЗАПУСКА",
    '"НАЖМИТЕ ДЛЯ ЗАПУСКА"': '"НАЖАТЬ ДЛЯ ЗАПУСКА"',
    # HOLD to investigate
    "Удерживайте, чтобы исследовать": "Удерживать, чтобы исследовать",
    '"Удерживайте, чтобы исследовать"': '"Удерживать, чтобы исследовать"',
    "Придержите, чтобы расследовать": "Удерживать, чтобы расследовать",
    '"Придержите, чтобы расследовать"': '"Удерживать, чтобы расследовать"',

    # Category B: Choice labels (parenthetical actions -> infinitive)
    "(Задайте вопрос.)": "(Задать вопрос.)",
    "(Поясните.)": "(Пояснить.)",
    "(Возвращайтесь к работе.)": "(Вернуться к работе.)",
    "(Продолжайте игнорировать его.)": "(Продолжить игнорировать его.)",
    "(Продолжайте.)": "(Продолжить.)",
    "(Удерживайте его взгляд.)": "(Удерживать его взгляд.)",
    "(Присоединяйтесь.)": "(Присоединиться.)",
    "(Продолжайте лгать.)": "(Продолжить лгать.)",
    "(Продолжайте думать.)": "(Продолжить думать.)",
    "(Продолжайте наблюдать за ним.)": "(Продолжить наблюдать за ним.)",
    "(Отказывайтесь говорить об этом.)": "(Отказаться говорить об этом.)",
    "(Посидите минутку.)": "(Посидеть минутку.)",
    "(Не двигайтесь.)": "(Не двигаться.)",
    "(Передохните.)": "(Передохнуть.)",
    "(Вздремните.)": "(Вздремнуть.)",
    "(Подумайте о местах.)": "(Подумать о местах.)",
    "(Попытайтесь успокоить ее.)": "(Попытаться успокоить её.)",
    "(Попробуйте сменить станцию.)": "(Попробовать сменить станцию.)",
    "(Избегайте темы.)": "(Уклониться от темы.)",
    "(Избегайте этой темы.)": "(Уклониться от этой темы.)",
    "(Не говорите ничего.)": "(Ничего не говорить.)",
    "(Держите себя в руках.)": "(Держать себя в руках.)",
    "(Пошевеливайтесь.)": "(Поторопиться.)",
    "(Заведите двигатель.)": "(Завести двигатель.)",
    "(Прибавьте жару.)": "(Прибавить жару.)",
    "(Не обращайте на них внимания.)": "(Не обращать на них внимания.)",

    # Narration/stage directions missed in v2
    "Послушайте это. Это то, что я играл сегодня вечером. Это мое.":
        "Послушать это. Это то, что я играл сегодня вечером. Это мое.",
    "Послушайте...": "Послушать...",
    "Послушайте, я вам сейчас все объясню. Если возникнет проблема, бросьте этот кубик.":
        "Послушать, я вам сейчас все объясню. Если возникнет проблема, бросить этот кубик.",
    "Послушайте... Вы, конечно, знаете, что я не имею права давать вам такую информацию...":
        "Послушать... Вы, конечно, знаете, что я не имею права давать вам такую информацию...",
}

fixed = 0
for key, val in data.items():
    if val in fixes:
        new_val = fixes[val]
        print(f"  FIX: \"{val[:60]}\" -> \"{new_val[:60]}\"")
        print(f"       KEY: {key[:80]}")
        data[key] = new_val
        fixed += 1

print(f"\nFixed: {fixed}")
print(f"Total entries: {len(data)}")

with open(json_path, 'w', encoding='utf-8') as f:
    json.dump(data, f, ensure_ascii=False, indent=2)

print("Done. JSON saved.")
